# Omarchy Linux Post-Installation Scripts

Scripts de configura√ß√£o p√≥s-instala√ß√£o para Omarchy Linux (distribui√ß√£o baseada em Arch Linux com Hyprland).

## post-omarchy-setup.sh

Script automatizado com menu interativo para configurar o ambiente ap√≥s uma instala√ß√£o limpa do Omarchy Linux. O script assume que o sistema j√° possui `yay` instalado (padr√£o no Omarchy).

### üé® Menu Interativo

O script apresenta um menu interativo que permite:
- Sele√ß√£o individual de componentes para instalar
- Perfis pr√©-configurados (Recomendados, Desenvolvimento Completo)
- Detec√ß√£o autom√°tica de hardware (Dell XPS 13 Plus)
- Visualiza√ß√£o clara do que ser√° instalado antes de confirmar

### Funcionalidades Dispon√≠veis

#### üì¶ Aplica√ß√µes Principais
- **Google Chrome** - Navegador web
- **CopyQ** - Gerenciador de clipboard avan√ßado
- **Dropbox** - Cliente de sincroniza√ß√£o de arquivos
- **AWS VPN Client** - Cliente VPN da AWS (com configura√ß√£o autom√°tica de servi√ßos)
- **Postman** - Ferramenta para teste de APIs

#### üõ†Ô∏è JetBrains IDEs
- **JetBrains Toolbox** - Gerenciador de IDEs JetBrains
- **Rider** - IDE para .NET
- **DataGrip** - IDE para bancos de dados

> **Nota:** Os pacotes s√£o instalados do AUR usando os nomes corretos `rider` e `datagrip`

#### üíª IDEs e Editores de C√≥digo
- **Cursor** - IDE moderna com IA integrada para desenvolvimento

#### üöÄ Ambientes de Desenvolvimento via Mise
- **Node.js**: Vers√£o LTS por padr√£o (com verifica√ß√£o de instala√ß√£o pr√©via)
- **.NET SDK**: 
  - Vers√£o 9 como padr√£o global
  - Vers√£o 8 instalada adicionalmente
  
> **Nota:** O script verifica se os runtimes j√° est√£o instalados antes de tentar reinstal√°-los

#### üìù CLIs via NPM
- **Claude Code** - CLI oficial do Claude da Anthropic

#### üé® Configura√ß√µes do Hyprland
- Sincroniza√ß√£o de dotfiles do Hypr (`~/.config/hypr`)
- Sincroniza√ß√£o de dotfiles do Hyprl (`~/.config/hyprl`)
- Cria backups datados antes de sobrescrever configura√ß√µes existentes
- Usa `rsync` para sincroniza√ß√£o eficiente (com fallback para `cp`)

#### üíª Suporte para Dell XPS 13 Plus (9320)

O script detecta automaticamente o Dell XPS 13 Plus e oferece configura√ß√µes espec√≠ficas:

**Configura√ß√£o da Webcam IPU6:**
- Instala√ß√£o do driver IVSC (via AUR ou compila√ß√£o do fonte)
- Instala√ß√£o dos bin√°rios e HAL da c√¢mera IPU6
- Configura√ß√£o de regras udev
- Configura√ß√£o de m√≥dulos para carregamento autom√°tico
- Verifica√ß√£o de firmware

**Otimiza√ß√µes de Hardware:**
- Instala√ß√£o e configura√ß√£o do `thermald` para gerenciamento t√©rmico
- Instala√ß√£o e configura√ß√£o do TLP para gerenciamento de energia
- Instala√ß√£o do `powertop` para an√°lise de consumo
- Detec√ß√£o e configura√ß√£o de √°udio Tiger Lake

### Uso

```bash
# Execu√ß√£o padr√£o com menu interativo
./post-omarchy-setup.sh

# Execu√ß√£o sem menu (usa configura√ß√µes padr√£o)
./post-omarchy-setup.sh --no-menu

# Com vari√°veis de ambiente customizadas
HYPR_SRC_DIR=/path/to/my/dotfiles/hypr ./post-omarchy-setup.sh
```

### Op√ß√µes do Menu

- **N√∫meros (1-13)**: Marcar/desmarcar componentes individuais
- **a**: Marcar/desmarcar todos
- **r**: Selecionar configura√ß√£o recomendada (essenciais)
- **d**: Selecionar configura√ß√£o de desenvolvimento completo
- **x**: Prosseguir com a instala√ß√£o
- **q**: Sair sem instalar

### Vari√°veis de Configura√ß√£o

O script permite customiza√ß√£o atrav√©s de vari√°veis de ambiente:

```bash
# Vers√µes de runtime
DEFAULT_NODE="lts"              # Vers√£o do Node.js (lts, 22, 20, etc)
DEFAULT_DOTNET_DEFAULT="9"      # Vers√£o padr√£o do .NET
EXTRA_DOTNET=("8")             # Vers√µes adicionais do .NET

# Diret√≥rios de dotfiles
HYPR_SRC_DIR="./dotfiles/hypr"    # Origem dos configs do Hypr
HYPRL_SRC_DIR="./dotfiles/hyprl"  # Origem dos configs do Hyprl
HYPR_DST_DIR="$HOME/.config/hypr"    # Destino Hypr
HYPRL_DST_DIR="$HOME/.config/hyprl"  # Destino Hyprl
```

### Recursos de Seguran√ßa

- **Modo fail-safe**: Script usa `set -euo pipefail` para parar em erros
- **Verifica√ß√£o de privil√©gios**: Requer sudo mas n√£o deve ser executado como root
- **Yay sem root**: O script evita usar yay com sudo (usa --sudoloop para solicitar senha quando necess√°rio)
- **Backups autom√°ticos**: Cria backups datados antes de sobrescrever configura√ß√µes
- **Tratamento de erros**: Usa `warn` para falhas n√£o-cr√≠ticas, permitindo continua√ß√£o
- **Logging colorido**: Feedback visual claro do progresso e status

### Estrutura de Logging

- üü¢ `[ OK ]` - Opera√ß√£o conclu√≠da com sucesso
- üîµ `[ .. ]` - Opera√ß√£o em progresso
- üü° `[ !! ]` - Aviso (n√£o-cr√≠tico)
- üî¥ `[ERR]` - Erro cr√≠tico

### Sum√°rio Final

Ao final da execu√ß√£o, o script apresenta um sum√°rio detalhado contendo:
- ‚úì Pacotes instalados com sucesso (com origem: pacman/AUR/npm)
- ‚úì Runtimes configurados via mise
- ‚è© Pacotes/Runtimes j√° instalados (pulados)
- ‚úó Pacotes que falharam na instala√ß√£o
- Diret√≥rios de configura√ß√£o sincronizados

### Dell XPS 13 Plus (9320) - Informa√ß√µes Adicionais

Se voc√™ possui um Dell XPS 13 Plus, o script:

1. **Detecta automaticamente** o hardware durante o menu inicial
2. **Oferece configura√ß√£o espec√≠fica** para webcam IPU6
3. **Aplica otimiza√ß√µes** de energia e desempenho
4. **Configura m√≥dulos** necess√°rios para carregamento autom√°tico

**Ap√≥s a instala√ß√£o da webcam:**
- Pode ser necess√°rio reiniciar o sistema
- Verificar status: `sudo dmesg | grep -i ipu6`
- Listar dispositivos: `v4l2-ctl --list-devices`
- Testar webcam: Use aplicativos como `cheese` ou `guvcview`

**Refer√™ncias:**
- [Arch Wiki - Dell XPS 13 Plus (9320)](https://wiki.archlinux.org/title/Dell_XPS_13_Plus_(9320))

### Pr√©-requisitos

- Omarchy Linux instalado (Arch Linux + Hyprland)
- `yay` instalado (padr√£o no Omarchy)
- `mise` instalado (assumido pelo Omarchy)
- Acesso sudo configurado
- Conex√£o com internet para baixar pacotes

### Notas

- O script √© idempotente - pode ser executado m√∫ltiplas vezes com seguran√ßa
- Dropbox service √© habilitado automaticamente via systemd user service
- AWS VPN Client configura automaticamente systemd-resolved e awsvpnclient.service
- O script continua mesmo se algumas instala√ß√µes falharem (comportamento resiliente)
- O menu interativo facilita a personaliza√ß√£o da instala√ß√£o
- A detec√ß√£o de hardware √© autom√°tica e n√£o-intrusiva

### Troubleshooting

**Problema com yay:**
- Se receber erro sobre uso de yay como root, o script j√° trata isso automaticamente

**AWS VPN Client n√£o conecta:**
- Verifique se systemd-resolved est√° rodando: `systemctl status systemd-resolved`
- Verifique se o servi√ßo est√° ativo: `systemctl status awsvpnclient`
- Reinicie os servi√ßos se necess√°rio: `sudo systemctl restart systemd-resolved awsvpnclient`

**Webcam n√£o funciona no Dell XPS:**
- Reinicie o sistema ap√≥s a instala√ß√£o
- Verifique se os m√≥dulos foram carregados: `lsmod | grep -E 'intel_vsc|mei_csi|mei_ace'`
- Verifique logs: `journalctl -xe | grep -i ipu6`

**Mise n√£o encontrado:**
- Instale mise manualmente: `curl -fsSL https://mise.jdx.dev/install.sh | sh`
- Adicione ao PATH conforme instru√ß√µes da instala√ß√£o